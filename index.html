<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NeuralNet Coin (NNC)</title>
  <link rel="icon" type="image/png" href="nnc_logo.png" />
  <style>
    :root{--bg:radial-gradient(circle at top,#111827 0%,#000 50%,#000 100%);--card:rgba(15,23,42,.55);--border:rgba(148,163,184,.15);--accent:#38bdf8}
    *{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:var(--bg);color:#fff;min-height:100vh}
    header{border-bottom:1px solid rgba(255,255,255,.03);backdrop-filter:blur(12px);position:sticky;top:0;z-index:20;background:rgba(0,0,0,.35)}
    .nav-inner{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:1rem 1.25rem}
    .logo-wrap{display:flex;gap:.6rem;align-items:center}.coin-dot{width:80px;height:auto;object-fit:contain;background:transparent;border:none}
    .nav-links a{margin-left:1rem;color:rgba(255,255,255,.65);text-decoration:none;font-size:.85rem}.nav-links a:hover{color:#fff}
    .hero{max-width:1200px;margin:0 auto;padding:2.2rem 1.25rem 1.8rem;display:grid;grid-template-columns:1.1fr .9fr;gap:2rem}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    .badge{font-size:.6rem;letter-spacing:.35em;text-transform:uppercase;background:rgba(56,189,248,.08);color:#e2f3ff;padding:.35rem .85rem;border:1px solid rgba(56,189,248,.3);border-radius:9999px;display:inline-block;margin-bottom:1.2rem}
    h1{font-size:clamp(2.4rem,5vw,3.3rem);line-height:1;margin-bottom:1rem}
    .muted{color:rgba(226,232,255,.68);line-height:1.6;max-width:34rem;font-size:.95rem;margin-bottom:1.2rem}
    .btn-row{display:flex;gap:.65rem;flex-wrap:wrap}.btn-primary{background:#fff;color:#000;padding:.6rem 1.35rem;border-radius:.75rem;border:none;font-weight:600;cursor:pointer;font-size:.85rem}
    .btn-secondary{background:rgba(255,255,255,.04);border:1px solid rgba(226,232,255,.12);color:#fff;padding:.6rem 1.35rem;border-radius:.75rem;font-weight:500;cursor:pointer}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:1.25rem;padding:1.25rem 1.2rem 1.2rem;box-shadow:0 10px 40px rgba(15,23,42,.25)}
    .panel-title{font-weight:600;margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}
    .kv-row{display:flex;justify-content:space-between;margin-bottom:.65rem;gap:1rem}.kv-label{color:rgba(226,232,255,.45);font-size:.75rem}.kv-value{font-size:.75rem;word-break:break-all}
    .section{max-width:1200px;margin:0 auto;padding:1.5rem 1.25rem 2rem}.section h2{margin-bottom:.65rem}
    .presale-box{background:linear-gradient(135deg,rgba(148,163,184,.04),rgba(56,189,248,.05));border:1px solid rgba(148,163,184,.25);border-radius:1.25rem;padding:1rem 1.25rem;max-width:32rem}
    .small{font-size:.75rem;color:rgba(226,232,255,.55)}footer{text-align:center;padding:1.5rem 1.25rem 2.5rem;color:rgba(148,163,184,.35);font-size:.7rem}
    .status-pill{background:rgba(250,204,21,.12);color:#fde68a;font-size:.65rem;padding:.35rem .6rem;border-radius:9999px}
    .pay-btn{background:#fff;color:#000;border:none;padding:.55rem 1rem;border-radius:.5rem;font-weight:600;cursor:pointer;font-size:.75rem}.pay-btn:disabled{opacity:.35;cursor:not-allowed}
    .status-text{font-size:.7rem;margin-top:.55rem;color:#bae6fd;word-break:break-all}
  </style>
</head>
<body>
  <!-- ‚Ä¶ your existing HTML content unchanged ‚Ä¶ -->

  <!-- 1) Minimal globals -->
  <script>
    if (!window.global) window.global = window;             /* some deps read global */
    if (!window.process) window.process = { env: {} };      /* some deps read process.env */
  </script>

  <!-- 2) Buffer polyfill (NO tiny fallback) -->
  <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.min.js"
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    (function () {
      // derive from UMD global
      var B = window?.buffer?.Buffer;
      if (!B) {
        document.body.insertAdjacentHTML('beforeend',
          '<div style="color:#fecaca">Buffer polyfill failed to load.</div>');
        throw new Error('Buffer polyfill failed to load');
      }
      // expose consistently
      window.Buffer = B;
      if (typeof globalThis !== 'undefined') {
        globalThis.Buffer = B;
        globalThis.buffer = { Buffer: B };
      }
      if (!window.buffer) window.buffer = { Buffer: B };
      // harden to avoid accidental overwrite
      try { Object.freeze(window.Buffer); } catch {}
      // quick assert
      console.log('[NNC] Buffer OK:', typeof Buffer.alloc === 'function');
    })();
  </script>

  <!-- 3) web3 AFTER polyfills (pin to known-good) -->
  <script src="https://unpkg.com/@solana/web3.js@1.91.9/lib/index.iife.js"></script>

  <!-- 4) App logic -->
  <script>
    const connectBtn = document.getElementById("connectBtn");
    const payBtn = document.getElementById("payBtn");
    const walletAddr = document.getElementById("walletAddr");
    const txStatus = document.getElementById("txStatus");
    const TREASURY = "JD2sVKxN11Ezn4AYVD4s2JiRUt1Y5Rb5SFueCD5FsmVN";

    function getProvider() {
      if (window.solana?.isPhantom) return window.solana;
      if (window.phantom?.solana) return window.phantom.solana;
      return null;
    }

    async function connectWallet() {
      const provider = getProvider();
      if (!provider) { alert("Phantom Wallet not found! Install it from https://phantom.app"); return; }
      try {
        const resp = await provider.connect();
        walletAddr.textContent = `‚úÖ Connected: ${resp.publicKey.toString()}`;
        payBtn.disabled = false;
      } catch (e) {
        console.error(e);
        walletAddr.textContent = "‚ùå Wallet connection rejected.";
      }
    }

    async function sendPayment() {
      const provider = getProvider();
      if (!provider) { alert("Please install / connect Phantom first!"); return; }
      if (!provider.publicKey) { alert("Please connect Phantom first!"); return; }

      try {
        txStatus.textContent = "Building transaction...";

        const connection = new solanaWeb3.Connection(
          solanaWeb3.clusterApiUrl("mainnet-beta"),
          "confirmed"
        );

        const lamports = Math.floor(0.01 * solanaWeb3.LAMPORTS_PER_SOL);

        const tx = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: provider.publicKey,
            toPubkey: new solanaWeb3.PublicKey(TREASURY),
            lamports, // must be a JS number (<= 2^53-1) ‚Äî here it's 10_000_000
          })
        );

        tx.feePayer = provider.publicKey;
        const { blockhash, lastValidBlockHeight } =
          await connection.getLatestBlockhash("finalized");
        tx.recentBlockhash = blockhash;

        let sig;
        if (typeof provider.signAndSendTransaction === "function") {
          // fewer serialization edge-cases in some wallets
          const res = await provider.signAndSendTransaction(tx);
          sig = res.signature ?? res; // Phantom returns { signature }
        } else {
          const signed = await provider.signTransaction(tx);
          sig = await connection.sendRawTransaction(signed.serialize());
        }

        txStatus.innerHTML = `‚è≥ Sent. Waiting for confirmation...<br>Sig: ${sig}`;

        await connection.confirmTransaction(
          { signature: sig, blockhash, lastValidBlockHeight },
          "confirmed"
        );

        txStatus.innerHTML = `‚úÖ 0.01 SOL sent!<br>
          üîó <a href="https://explorer.solana.com/tx/${sig}?cluster=mainnet-beta" target="_blank" style="color:#38bdf8;">View on Solana Explorer</a>`;
      } catch (err) {
        console.error(err);
        txStatus.textContent = "‚ùå " + (err.message || String(err));
      }
    }

    connectBtn.addEventListener("click", connectWallet);

    // Optional quick health check in console
    console.log('[NNC] Sanity:',
      { hasBuffer: !!window.Buffer, hasAlloc: !!Buffer.alloc, hasWeb3: !!window.solanaWeb3 });
  </script>
</body>
</html>
